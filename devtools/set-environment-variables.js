const fs = require('fs-extra');
const dotenv = require('dotenv');
const envPath = '.env';
const targetPath = './src/app/config/environment-variables.ts';

if (fs.pathExistsSync(envPath)) {
    const result = dotenv.config();

    if (result.error) {
        throw console.error(result.error);
    }
}

const environmentVariablesFile = `export const environmentVariables = {
    /**
     *  This file is auto-generated by script '/devtools/set-environment-variables.js'
     *   Do not modify it manually
     */
    API_URL: '${process.env.API_URL || ''}',
    SQUARE_ACCESS_TOKEN: '${process.env.SQUARE_ACCESS_TOKEN || ''}',
    SQUARE_APP_ID: '${process.env.SQUARE_APP_ID || ''}',
    SQUARE_LOCATION_ID: '${process.env.SQUARE_LOCATION_ID || ''}'
}`;

fs.outputFile(targetPath, environmentVariablesFile, function (err) {
    if (err) {
        throw console.error(err);
    } else {
        console.log(`Environment variables file re-generated at ${targetPath}: \n`);
        console.log(environmentVariablesFile, '\n');
    }
});
